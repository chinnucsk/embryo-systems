#!/bin/bash

# Copyright 2010 Nicolas R Dufour <nrdufour@gmail.com>
# 
# Licensed under the Apache License, Version 2.0 (the "License"); you may not
# use this file except in compliance with the License. You may obtain a copy of
# the License at
# 
#   http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations under
# the License.

function quit {
  exit
}

PREFIX="/opt/embryosys"
EMBRYOSYS_USER=`whoami`
ABSPATH="$(cd "${0%/*}" 2>/dev/null; echo "$PWD"/"${0##*/}")"
DIRPATH=`dirname "$ABSPATH"`

while [ $# -gt 0 ]
do
  case $1
  in
    -p)
      PREFIX=$2
      shift 2
    ;;
    -t)
      TEMPLATE=$2
      shift 2
    ;;
    -d)
      DATA=$2
      shift 2
    ;;
    -u)
      EMBRYOSYS_USER=$2
      shift 2
    ;;
    *)
      echo "usage: $0 [-p {prefix} -t {template} -d {data_dir} -u {user}]"
      quit
    ;;
  esac
done

if test ! -n "$DATA"; then DATA="$PREFIX/var/lib"; fi

echo "==> configuring embryosys in rel/embryosys.config"
cat > rel/embryosys.config << EOF
{prefix, "$PREFIX"}.
{data_dir, "$DATA"}.
{user, "$EMBRYOSYS_USER"}.
{node_name, "-name embryosys"}.
EOF

cat > install.mk << EOF
# The contents of this file are auto-generated by configure
prefix = $PREFIX
data_dir = $DATA
user = $EMBRYOSYS_USER
EOF

cat rel/embryosys.config
